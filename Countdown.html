<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026æ³•è€ƒå€’è®¡æ—¶ - å¤‡è€ƒåŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600;700&family=Noto+Sans+SC:wght@300;400;500;700&family=Roboto+Mono:wght@500;700&display=swap" rel="stylesheet">
    <style>
        /* åŸºç¡€å˜é‡å®šä¹‰ */
        :root {
            --primary-color: #4c75e6;
            --glass-bg: rgba(255, 255, 255, 0.12);
            --glass-border: rgba(255, 255, 255, 0.25);
            --text-main: #ffffff;
            --text-muted: rgba(255, 255, 255, 0.85);
            --accent-glow: rgba(76, 117, 230, 0.4);
            --card-bg: rgba(20, 30, 60, 0.6);
            --title-gradient-from: var(--text-main);
            --title-gradient-to: rgba(255,255,255,0.8);
        }

        /* ä¸»é¢˜ï¼šæ—¥å‡ºæ¨¡å¼ */
        [data-theme="sunrise"] {
            --primary-color: #ff8c42;
            --glass-bg: rgba(255, 255, 255, 0.2);
            --glass-border: rgba(255, 255, 255, 0.4);
            --text-main: #5a3d2b;
            --text-muted: rgba(90, 61, 43, 0.9);
            --accent-glow: rgba(255, 140, 66, 0.5);
            --card-bg: rgba(255, 240, 220, 0.6);
            --title-gradient-from: var(--text-main);
            --title-gradient-to: rgba(90, 61, 43, 0.8);
        }

        /* ä¸»é¢˜ï¼šæŠ¤çœ¼æ¨¡å¼ */
        [data-theme="eyecare"] {
            --primary-color: #5d8c7f;
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.3);
            --text-main: #2c4a3f;
            --text-muted: rgba(44, 74, 63, 0.85);
            --accent-glow: rgba(93, 140, 127, 0.4);
            --card-bg: rgba(232, 245, 233, 0.7);
            --title-gradient-from: var(--text-main);
            --title-gradient-to: rgba(44, 74, 63, 0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.5s ease, color 0.3s ease;
        }

        /* ========== æ ¸å¿ƒå±…ä¸­ä¿®æ”¹ ========== */
        body {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Noto Sans SC', "PingFang SC", "Microsoft YaHei", sans-serif;
            overflow: hidden;
            position: relative;
            background-color: #0f172a;
            padding: 1rem;
            margin: 0; /* ç¡®ä¿bodyæ— é»˜è®¤å¤–è¾¹è· */
        }

        /* ä¸»å®¹å™¨å¼ºåˆ¶å±…ä¸­ */
        .main-container {
            position: relative;
            width: 100%;
            max-width: 500px; /* ä¸å¡ç‰‡æœ€å¤§å®½åº¦ä¸€è‡´ */
            margin: 0 auto; /* æ°´å¹³å±…ä¸­ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* åŠ¨æ€CanvasèƒŒæ™¯å±‚ - å…¨å±è¦†ç›– */
        #bgCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw; /* è§†å£å®½åº¦ */
            height: 100vh; /* è§†å£é«˜åº¦ */
            z-index: 0;
        }

        /* ç»ç’ƒæ‹Ÿæ€ä¸»å¡ç‰‡ - ç«–å±é»˜è®¤æ ·å¼ */
        .glass-card {
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 32px;
            box-shadow: 
                0 25px 50px -12px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.1) inset,
                0 0 100px var(--accent-glow) inset;
            position: relative;
            z-index: 10;
            transform: translateY(0);
            transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.5s;
            color: var(--text-main);
            width: 100%;
            max-width: 500px;
            padding: 2rem;
            margin: 0 auto; /* ç¡®ä¿å¡ç‰‡è‡ªèº«ä¹Ÿå±…ä¸­ */
        }

        /* ç¿»ç‰Œæ—¶é’Ÿæ ·å¼ */
        .flip-clock {
            perspective: 1000px;
            display: inline-block;
            width: 60px;
            height: 70px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            position: relative;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            overflow: hidden;
            font-family: 'Roboto Mono', monospace;
            cursor: pointer;
        }

        /* æ—¶åˆ†ç§’ç‚¹å‡»åŠ¨æ•ˆ */
        .flip-clock.clicked {
            animation: clockClick 0.5s ease-in-out;
        }

        @keyframes clockClick {
            0% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .flip-clock-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            line-height: 70px;
            font-size: 32px;
            font-weight: 700;
            color: #1e293b;
            transform-style: preserve-3d;
        }

        .flip-clock.flipping .flip-clock-inner {
            animation: flipDown 0.6s ease-in-out;
        }

        @keyframes flipDown {
            0% { transform: rotateX(0); }
            50% { transform: rotateX(-90deg); opacity: 0.8; }
            100% { transform: rotateX(0); }
        }

        /* æ ‡é¢˜å­—ä½“æ ·å¼ */
        .title-calligraphy {
            font-family: 'Noto Sans SC', "PingFang SC", "Microsoft YaHei", sans-serif;
            font-size: 2.2rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-shadow: 
                0 4px 12px rgba(0,0,0,0.3),
                0 0 40px var(--accent-glow);
            background: linear-gradient(to bottom, var(--title-gradient-from), var(--title-gradient-to));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            transition: all 0.5s ease;
        }

        /* é‡Œç¨‹ç¢‘è¿›åº¦æ¡ */
        .milestone-track {
            background: rgba(128, 128, 128, 0.2);
            height: 6px;
            border-radius: 3px;
            position: relative;
            margin-top: 10px;
        }
        .milestone-fill {
            background: var(--primary-color);
            height: 100%;
            border-radius: 3px;
            transition: width 1s ease;
            box-shadow: 0 0 10px var(--accent-glow);
        }
        .milestone-node {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 12px;
            height: 12px;
            background: var(--card-bg);
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            transition: all 0.3s;
        }
        .milestone-node.active {
            background: var(--primary-color);
            box-shadow: 0 0 10px var(--primary-color);
            transform: translate(-50%, -50%) scale(1.3);
        }

        /* ç•ªèŒ„é’Ÿåœ†å½¢è¿›åº¦ */
        .pomodoro-ring {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        .pomodoro-circle {
            transition: stroke-dashoffset 1s linear;
        }

        /* æŒ‰é’®äº¤äº’ */
        .btn-interactive {
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        .btn-interactive:active {
            transform: scale(0.95);
        }
        .btn-interactive::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }
        .btn-interactive:active::after {
            width: 200px;
            height: 200px;
        }

        /* æ³•è€ƒåŠ æ²¹æŒ‰é’®ç‰¹æ®Šæ ·å¼ */
        .cheer-btn {
            background: linear-gradient(135deg, var(--primary-color), #7c3aed);
            position: relative;
            overflow: hidden;
        }
        
        .cheer-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        
        .cheer-btn:hover::before {
            left: 100%;
        }

        .cheer-btn.playing {
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px var(--accent-glow); }
            50% { box-shadow: 0 0 40px var(--accent-glow), 0 0 60px var(--primary-color); }
        }

        /* éšè—çŠ¶æ€ */
        .hidden-section {
            display: none !important;
        }

        /* æç¤ºæ¶ˆæ¯ */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 24px;
            font-size: 14px;
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
            pointer-events: none;
        }
        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* æ—¶é—´æ¿€åŠ±è¯­æµ®å±‚ */
        .time-motivation {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            color: var(--text-main);
            font-size: 14px;
            font-family: 'Noto Serif SC', serif;
            opacity: 0;
            padding: 8px 20px;
            border-radius: 16px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            transition: all 0.8s ease;
            z-index: 999;
            pointer-events: none;
            max-width: 80%;
            text-align: center;
        }

        .time-motivation.show {
            opacity: 0.9;
            transform: translateX(-50%) translateY(0);
        }

        /* éšè—æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            display: none;
        }

        /* å¤©æ•°åŒºåŸŸç‚¹å‡»æ ·å¼ */
        #dayNum {
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        #dayNum:hover {
            transform: scale(1.05);
        }

        #dayLabel {
            transition: all 0.3s ease;
        }

        /* åè¨€åŒºåŸŸæ ·å¼ä¼˜åŒ– */
        .poem-container {
            padding: 1rem 0;
            margin-bottom: 1.5rem;
            max-width: 100%;
        }

        #poemText {
            line-height: 1.6;
            font-size: 1.1rem;
            letter-spacing: 0.05em;
        }

        /* ä¸»è§‚é¢˜/å®¢è§‚é¢˜åˆ‡æ¢æŒ‰é’®æ ·å¼ */
        .exam-switch-btn {
            padding: 4px 10px; /* å¾®è°ƒå†…è¾¹è·ï¼Œé€‚é…åŒè¡Œæ˜¾ç¤º */
            border-radius: 999px;
            border: 1px solid var(--glass-border);
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.8rem; /* å¾®è°ƒå­—ä½“å¤§å° */
            white-space: nowrap;
        }

        .exam-switch-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 0 8px var(--accent-glow);
        }

        /* é¡¶éƒ¨åŠŸèƒ½æŒ‰é’®ç»„ä¼˜åŒ– - æ ¸å¿ƒä¿®æ”¹ï¼šå¼ºåˆ¶åŒè¡Œæ˜¾ç¤º */
        .top-function-group {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 6px; /* ç»Ÿä¸€é—´è· */
            flex-wrap: nowrap !important; /* å¼ºåˆ¶ä¸æ¢è¡Œ */
            margin-top: 12px;
            width: 100%;
            overflow-x: auto; /* å°å±å¹•ä¸‹å…è®¸æ¨ªå‘æ»šåŠ¨ */
            padding: 4px 0;
        }
        
        /* éšè—æ¨ªå‘æ»šåŠ¨æ¡ä½†ä¿ç•™æ»šåŠ¨åŠŸèƒ½ */
        .top-function-group::-webkit-scrollbar {
            display: none;
        }
        
        /* è°ƒæ•´è€ƒè¯•é˜¶æ®µæ ‡ç­¾æ ·å¼ */
        #examPhase {
            font-size: 0.75rem;
            padding: 3px 8px;
            white-space: nowrap;
        }
        
        /* è°ƒæ•´åˆ‡æ¢ä¸»é¢˜æŒ‰é’®æ ·å¼ */
        .theme-switch-btn {
            font-size: 0.75rem;
            padding: 3px 8px;
            white-space: nowrap;
        }
    </style>
</head>
<body>

    <!-- åŠ¨æ€èƒŒæ™¯Canvas -->
    <canvas id="bgCanvas"></canvas>

    <!-- ä¸»å®¹å™¨ - æ–°å¢ä¸“å±classç¡®ä¿å±…ä¸­ -->
    <div class="main-container">
        
        <!-- ä¸»å¡ç‰‡ -->
        <div class="glass-card" id="mainCard">
            
            <!-- é¡¶éƒ¨ï¼šæ ‡é¢˜ä¸åŠŸèƒ½æŒ‰é’® -->
            <div class="text-center mb-6">
                <h1 class="title-calligraphy">
                    2026æ³•å¾‹èŒä¸šèµ„æ ¼è€ƒè¯•
                </h1>
                <!-- æ ¸å¿ƒä¿®æ”¹ï¼šæ·»åŠ ä¸“å±classå¹¶è°ƒæ•´ç»“æ„ -->
                <div class="top-function-group">
                    <span id="examPhase" class="text-xs px-3 py-1 rounded-full bg-[var(--primary-color)] text-white opacity-90">
                        å®¢è§‚é¢˜å¤‡è€ƒä¸­
                    </span>
                    <!-- ä¸»è§‚é¢˜/å®¢è§‚é¢˜åˆ‡æ¢æŒ‰é’® -->
                    <div class="flex rounded-full border border-[var(--glass-border)] overflow-hidden">
                        <button id="objBtn" class="exam-switch-btn active text-xs px-2 py-1" onclick="switchExamType(true)">
                            å®¢è§‚é¢˜
                        </button>
                        <button id="subBtn" class="exam-switch-btn text-xs px-2 py-1" onclick="switchExamType(false)">
                            ä¸»è§‚é¢˜
                        </button>
                    </div>
                    <button onclick="switchTheme()" class="theme-switch-btn text-xs px-2 py-1 rounded-full border border-[var(--glass-border)] text-[var(--text-muted)] hover:bg-[var(--glass-bg)]">
                        åˆ‡æ¢ä¸»é¢˜
                    </button>
                </div>
            </div>

            <!-- åè¨€åŒºåŸŸ -->
            <div class="poem-container relative mb-6 cursor-pointer select-none" id="poemContainer">
                <div class="absolute top-0 left-0 text-4xl opacity-20 font-serif">"</div>
                <p id="poemText" class="text-center text-lg md:text-xl font-serif italic text-[var(--text-main)] py-2 px-6 leading-relaxed">
                    åƒæ·˜ä¸‡æ¼‰è™½è¾›è‹¦ï¼Œå¹å°½ç‹‚æ²™å§‹åˆ°é‡‘
                </p>
                <div class="absolute bottom-0 right-0 text-4xl opacity-20 font-serif rotate-180">"</div>
            </div>

            <!-- å€’è®¡æ—¶ä¸»ä½“ -->
            <div class="countdown-section text-center mb-8">
                <div class="text-sm text-[var(--text-muted)] mb-4 tracking-widest uppercase" id="countdownTitle">
                    è·å®¢è§‚é¢˜è€ƒè¯•è¿˜æœ‰
                </div>
                
                <!-- å¤©æ•°/å‘¨æ•°åˆ‡æ¢åŒºåŸŸ -->
                <div class="mb-6" onclick="toggleDayWeek()">
                    <div class="text-6xl md:text-7xl font-bold font-sans text-[var(--text-main)] tracking-tighter" id="dayNum" style="text-shadow: 0 4px 20px var(--accent-glow);">
                        0
                    </div>
                    <div class="text-sm text-[var(--text-muted)] mt-1 tracking-[0.5em] uppercase" id="dayLabel">å¤©</div>
                </div>

                <!-- æ—¶åˆ†ç§’ - ç¿»ç‰Œæ—¶é’Ÿ -->
                <div class="flex justify-center items-center gap-3 md:gap-4">
                    <div class="text-center">
                        <div class="flip-clock" id="hourBox" onclick="clockClickEffect(this)">
                            <div class="flip-clock-inner" id="hourVal">00</div>
                        </div>
                        <div class="text-xs text-[var(--text-muted)] mt-2 tracking-widest">æ—¶</div>
                    </div>
                    <div class="text-2xl font-bold text-[var(--text-main)] mb-6">:</div>
                    <div class="text-center">
                        <div class="flip-clock" id="minuteBox" onclick="clockClickEffect(this)">
                            <div class="flip-clock-inner" id="minuteVal">00</div>
                        </div>
                        <div class="text-xs text-[var(--text-muted)] mt-2 tracking-widest">åˆ†</div>
                    </div>
                    <div class="text-2xl font-bold text-[var(--text-main)] mb-6">:</div>
                    <div class="text-center">
                        <div class="flip-clock" id="secondBox" onclick="clockClickEffect(this)">
                            <div class="flip-clock-inner" id="secondVal">00</div>
                        </div>
                        <div class="text-xs text-[var(--text-muted)] mt-2 tracking-widest">ç§’</div>
                    </div>
                </div>
            </div>

            <!-- é‡Œç¨‹ç¢‘è¿›åº¦ -->
            <div class="mb-8 px-2">
                <div class="flex justify-between text-xs text-[var(--text-muted)] mb-2">
                    <span>åŸºç¡€é˜¶æ®µ</span>
                    <span>å¼ºåŒ–é˜¶æ®µ</span>
                    <span>å†²åˆºé˜¶æ®µ</span>
                    <span>è€ƒè¯•</span>
                </div>
                <div class="milestone-track">
                    <div class="milestone-fill" id="milestoneFill" style="width: 0%"></div>
                    <div class="milestone-node" style="left: 0%" data-index="0"></div>
                    <div class="milestone-node" style="left: 33%" data-index="1"></div>
                    <div class="milestone-node" style="left: 66%" data-index="2"></div>
                    <div class="milestone-node active" style="left: 100%" data-index="3"></div>
                </div>
            </div>

            <!-- æ“ä½œæŒ‰é’®åŒºï¼šä»…ä¿ç•™ä¸“æ³¨æ¨¡å¼ -->
            <div class="flex justify-center mb-6">
                <button onclick="togglePomodoro()" class="btn-interactive flex items-center gap-2 px-6 py-3 rounded-2xl bg-[var(--glass-bg)] border border-[var(--glass-border)] text-[var(--text-main)] hover:bg-[var(--glass-bg)]/80">
                    <svg class="w-5 h-5 text-[var(--primary-color)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="text-sm font-medium">ä¸“æ³¨æ¨¡å¼</span>
                </button>
            </div>

            <!-- æ³•è€ƒåŠ æ²¹æŒ‰é’®ï¼ˆé›†æˆéŸ³ä¹æ’­æ”¾ï¼‰ -->
            <button onclick="toggleCheer()" id="cheerBtn" class="w-full py-4 rounded-2xl cheer-btn text-white font-bold tracking-[0.3em] shadow-lg hover:shadow-xl transform transition hover:-translate-y-0.5 active:translate-y-0 btn-interactive text-lg flex items-center justify-center gap-2">
                <span id="musicIcon">ğŸµ</span>
                <span>æ³•è€ƒåŠ æ²¹</span>
            </button>

            <!-- é¼“åŠ±æ¶ˆæ¯æ˜¾ç¤ºåŒº -->
            <div id="encourageMsg" class="mt-4 text-center text-sm font-serif text-[var(--text-main)] opacity-0 transition-opacity duration-500 h-6">
                åšæŒå°±æ˜¯èƒœåˆ©ï¼
            </div>
        </div>

        <!-- ç•ªèŒ„é’Ÿè¦†ç›–å±‚ -->
        <div id="pomodoroLayer" class="hidden-section absolute inset-0 z-20 glass-card flex flex-col items-center justify-center p-8">
            <h3 class="text-2xl font-bold text-[var(--text-main)] mb-4">ä¸“æ³¨æ—¶åˆ»</h3>
            
            <!-- ç•ªèŒ„é’Ÿè‡ªå®šä¹‰æ—¶é—´è¾“å…¥æ¡† -->
            <div class="mb-6 flex items-center justify-center gap-2">
                <input type="number" id="pomoCustomTime" min="1" max="60" placeholder="è‡ªå®šä¹‰åˆ†é’Ÿæ•°" 
                       class="w-24 px-3 py-2 rounded-lg bg-[var(--glass-bg)] border border-[var(--glass-border)] text-[var(--text-main)] text-center">
                <button onclick="setCustomPomodoroTime()" 
                        class="px-3 py-2 rounded-lg bg-[var(--primary-color)] text-white text-sm">ç¡®è®¤</button>
            </div>
            
            <div class="relative w-48 h-48 mb-8">
                <svg class="w-full h-full" viewBox="0 0 100 100">
                    <circle class="text-gray-200 opacity-20" stroke-width="4" stroke="currentColor" fill="transparent" r="46" cx="50" cy="50"/>
                    <circle id="pomoProgress" class="pomodoro-circle text-[var(--primary-color)]" stroke-width="4" stroke-linecap="round" stroke="currentColor" fill="transparent" r="46" cx="50" cy="50" stroke-dasharray="289" stroke-dashoffset="0"/>
                </svg>
                <div class="absolute inset-0 flex items-center justify-center">
                    <span id="pomoTime" class="text-4xl font-mono font-bold text-[var(--text-main)]">25:00</span>
                </div>
            </div>

            <div class="flex gap-4">
                <button onclick="startPomodoro()" id="pomoStartBtn" class="px-8 py-3 rounded-full bg-[var(--primary-color)] text-white font-bold shadow-lg hover:shadow-xl transition">
                    å¼€å§‹
                </button>
                <button onclick="togglePomodoro()" class="px-8 py-3 rounded-full bg-[var(--glass-bg)] border border-[var(--glass-border)] text-[var(--text-main)] font-bold">
                    å…³é—­
                </button>
            </div>
            <p class="mt-6 text-sm text-[var(--text-muted)] text-center" id="pomoTipText">
                ä¿æŒä¸“æ³¨ï¼Œ25åˆ†é’ŸåçŸ­æš‚ä¼‘æ¯<br>æ³•å¾‹äººçš„è‡ªå¾‹ä»æ¯ä¸€åˆ»å¼€å§‹
            </p>
        </div>

    </div>

    <!-- æç¤ºæ¶ˆæ¯ -->
    <div class="toast" id="toast"></div>
    
    <!-- æ—¶é—´æ¿€åŠ±è¯­æµ®å±‚ -->
    <div class="time-motivation" id="timeMotivation"></div>

    <script>
        /* ========== æ•°æ®é…ç½® ========== */
        const EXAM_DATE_OBJ = new Date("2026-09-13T09:00:00").getTime(); // å®¢è§‚é¢˜
        const EXAM_DATE_SUB = new Date("2026-10-12T09:00:00").getTime(); // ä¸»è§‚é¢˜
        const START_DATE = new Date("2025-12-01").getTime(); // å¤‡è€ƒå¼€å§‹æ—¶é—´
        
        const POEMS = [
            { type: 'poem', text: "åƒæ·˜ä¸‡æ¼‰è™½è¾›è‹¦ï¼Œå¹å°½ç‹‚æ²™å§‹åˆ°é‡‘" },
            { type: 'poem', text: "é•¿é£ç ´æµªä¼šæœ‰æ—¶ï¼Œç›´æŒ‚äº‘å¸†æµæ²§æµ·" },
            { type: 'poem', text: "åšè§‚è€Œçº¦å–ï¼Œåšç§¯è€Œè–„å‘" },
            { type: 'poem', text: "æ˜Ÿå…‰ä¸è´Ÿèµ¶è·¯äººï¼Œæ—¶å…‰ä¸è´Ÿæœ‰å¿ƒäºº" },
            { type: 'poem', text: "é“é˜»ä¸”é•¿ï¼Œè¡Œåˆ™å°†è‡³ï¼›è¡Œè€Œä¸è¾ï¼Œæœªæ¥å¯æœŸ" },
            { type: 'poem', text: "ç»³é”¯æœ¨æ–­ï¼Œæ°´æ»´çŸ³ç©¿" },
            { type: 'poem', text: "å®å‰‘é”‹ä»ç£¨ç ºå‡ºï¼Œæ¢…èŠ±é¦™è‡ªè‹¦å¯’æ¥" },
            { type: 'law', text: "æ³•å¾‹ä¸ä¿æŠ¤æƒåˆ©ä¸Šçš„ç¡çœ è€…" },
            { type: 'law', text: "æ­£ä¹‰ä¸ä»…åº”å¾—åˆ°å®ç°ï¼Œè€Œä¸”è¦ä»¥äººä»¬çœ‹å¾—è§çš„æ–¹å¼åŠ ä»¥å®ç°" },
            { type: 'law', text: "æ²¡æœ‰æ— ä¹‰åŠ¡çš„æƒåˆ©ï¼Œä¹Ÿæ²¡æœ‰æ— æƒåˆ©çš„ä¹‰åŠ¡" },
            { type: 'law', text: "æ³•æ— æˆæƒä¸å¯ä¸ºï¼Œæ³•æ— ç¦æ­¢å³å¯ä¸º" },
            { type: 'law', text: "æ³•å¾‹çš„ç”Ÿå‘½åœ¨äºç»éªŒï¼Œè€Œä¸åœ¨äºé€»è¾‘" }
        ];

        const ENCOURAGES = [
            "åšæŒå°±æ˜¯èƒœåˆ©ï¼",
            "ä»Šå¤©çš„åŠªåŠ›ï¼Œæ˜¯æ˜å¤©çš„å®åŠ›ï¼",
            "æ¯ä¸€æ­¥éƒ½ç®—æ•°ï¼",
            "ä½ ç¦»æ¢¦æƒ³åˆè¿‘äº†ä¸€æ­¥ï¼",
            "ç¨³ä½ï¼Œæˆ‘ä»¬èƒ½èµ¢ï¼",
            "ä½ æ˜¯æœ€æ£’çš„æ³•è€ƒäººï¼",
            "åšç§¯è–„å‘ï¼Œä¸€é¸£æƒŠäººï¼",
            "ç›¸ä¿¡è‡ªå·±ï¼Œä½ èƒ½è¡Œï¼",
            "æ³•æ²»ç†æƒ³ï¼Œç”±ä½ å®ˆæŠ¤ï¼",
            "å¿ƒä¹‹æ‰€å‘ï¼Œç´ å±¥ä»¥å¾€ï¼"
        ];

        // ä¸æ—¶é—´ç›¸å…³çš„æ¿€åŠ±è¯­
        const TIME_MOTIVATIONS = [
            "æ¯ä¸€åˆ†é’Ÿçš„åŠªåŠ›ï¼Œéƒ½è®©ä½ ç¦»æˆåŠŸæ›´è¿‘",
            "çæƒœæ—¶é—´ï¼Œå°±æ˜¯çæƒœæœªæ¥çš„è‡ªå·±",
            "æ—¶é—´ä¸ä¼šè¾œè´Ÿç”¨å¿ƒçš„äºº",
            "ä¸€å‘¨çš„åšæŒï¼Œèƒœè¿‡ç™¾æ—¥çš„ç©ºæƒ³",
            "æŠŠæ¡å½“ä¸‹çš„æ¯ä¸€ç§’ï¼Œæ³•è€ƒè·¯ä¸Šä¸è¿·èŒ«",
            "å€’è®¡æ—¶çš„æ•°å­—ï¼Œæ˜¯ä½ å‰è¡Œçš„å‹‹ç« ",
            "ç”¨ä¸“æ³¨çš„æ—¶å…‰ï¼Œæ¢æœªæ¥çš„å¦é€”",
            "æ—¶é—´æœ‰é™ï¼Œæ•ˆç‡æ— é™",
            "æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼Œè€ƒè¯•è½»æ¾ä¸€ç‚¹ç‚¹",
            "æ—¶å…‰ä¸è¯­ï¼Œé™å¾…èŠ±å¼€"
        ];

        const THEMES = ['default', 'sunrise', 'eyecare'];
        const BG_MODES = ['stars', 'rain', 'ink'];

        /* ========== çŠ¶æ€ç®¡ç† ========== */
        let currentState = {
            theme: 0,
            bgMode: 0,
            poemIndex: 0,
            isPlaying: false, // éŸ³ä¹æ’­æ”¾çŠ¶æ€
            isObjective: true, // é»˜è®¤ä¸ºå®¢è§‚é¢˜
            pomoRunning: false,
            pomoTime: 25 * 60, // ç•ªèŒ„é’Ÿç§’æ•°
            pomoOriginalTime: 25 * 60, // ä¿å­˜åŸå§‹æ—¶é—´
            pomoInterval: null,
            showWeek: false // æ˜¯å¦æ˜¾ç¤ºå‘¨æ•°ï¼ˆé»˜è®¤æ˜¾ç¤ºå¤©æ•°ï¼‰
        };

        // éŸ³é¢‘ç›¸å…³ - å¾ªç¯æ’­æ”¾
        let cheerAudio = new Audio('https://xingjiuyuzhou.github.io/Countdown/jxszf.mp3');
        cheerAudio.loop = true;

        // ä»localStorageè¯»å–ï¼ˆæ–°å¢ï¼šè¯»å–è€ƒè¯•ç±»å‹åˆ‡æ¢çŠ¶æ€ï¼‰
        const saved = localStorage.getItem('fakao2026_settings');
        if (saved) {
            const data = JSON.parse(saved);
            currentState.theme = data.theme || 0;
            currentState.bgMode = data.bgMode || 0;
            currentState.poemIndex = data.poemIndex || 0;
            currentState.showWeek = data.showWeek || false;
            currentState.isObjective = data.isObjective !== undefined ? data.isObjective : true; // è¯»å–è€ƒè¯•ç±»å‹
            // åŠ è½½ä¿å­˜çš„ç•ªèŒ„é’Ÿè‡ªå®šä¹‰æ—¶é—´
            if (data.pomoOriginalTime) {
                currentState.pomoOriginalTime = data.pomoOriginalTime;
                currentState.pomoTime = data.pomoOriginalTime;
            }
        }

        /* ========== åˆå§‹åŒ– ========== */
        document.addEventListener('DOMContentLoaded', () => {
            applyTheme(currentState.theme);
            initBackground();
            // åˆå§‹åŒ–è€ƒè¯•ç±»å‹æ˜¾ç¤º
            updateExamTypeUI();
            updateCountdown();
            setInterval(updateCountdown, 1000);
            renderPoem();
            updateMilestone();
            initGestures();
            checkExamPhase();
            // åˆå§‹åŒ–ç•ªèŒ„é’Ÿæ˜¾ç¤º
            updatePomoDisplay();
            updatePomoTipText();
        });

        /* ========== ä¸»è§‚é¢˜/å®¢è§‚é¢˜åˆ‡æ¢åŠŸèƒ½ ========== */
        function switchExamType(isObjective) {
            // æ›´æ–°çŠ¶æ€
            currentState.isObjective = isObjective;
            // æ›´æ–°UIæ˜¾ç¤º
            updateExamTypeUI();
            // ç«‹å³æ›´æ–°å€’è®¡æ—¶
            updateCountdown();
            // æ›´æ–°é‡Œç¨‹ç¢‘è¿›åº¦
            updateMilestone();
            // ä¿å­˜è®¾ç½®
            saveSettings();
            // æ˜¾ç¤ºæç¤º
            showToast(`å·²åˆ‡æ¢è‡³${isObjective ? 'å®¢è§‚é¢˜' : 'ä¸»è§‚é¢˜'}å€’è®¡æ—¶`);
            // è§¦å‘æ¿€åŠ±è¯­æ˜¾ç¤º
            showRandomTimeMotivation();
        }

        // æ›´æ–°è€ƒè¯•ç±»å‹ç›¸å…³UI
        function updateExamTypeUI() {
            const isObjective = currentState.isObjective;
            // æ›´æ–°æŒ‰é’®æ¿€æ´»çŠ¶æ€
            document.getElementById('objBtn').classList.toggle('active', isObjective);
            document.getElementById('subBtn').classList.toggle('active', !isObjective);
            // æ›´æ–°è€ƒè¯•é˜¶æ®µæ–‡æœ¬
            document.getElementById('examPhase').textContent = isObjective 
                ? 'å®¢è§‚é¢˜å¤‡è€ƒä¸­' 
                : 'ä¸»è§‚é¢˜å¤‡è€ƒä¸­';
            // æ›´æ–°å€’è®¡æ—¶æ ‡é¢˜
            document.getElementById('countdownTitle').textContent = isObjective 
                ? 'è·å®¢è§‚é¢˜è€ƒè¯•è¿˜æœ‰' 
                : 'è·ä¸»è§‚é¢˜è€ƒè¯•è¿˜æœ‰';
        }

        /* ========== å€’è®¡æ—¶æ ¸å¿ƒé€»è¾‘ ========== */
        function updateCountdown() {
            const now = new Date().getTime();
            const target = currentState.isObjective ? EXAM_DATE_OBJ : EXAM_DATE_SUB;
            const diff = target - now;

            if (diff <= 0) {
                document.getElementById('dayNum').textContent = "0";
                document.getElementById('hourVal').textContent = "00";
                document.getElementById('minuteVal').textContent = "00";
                document.getElementById('secondVal').textContent = "00";
                document.getElementById('examPhase').textContent = currentState.isObjective 
                    ? 'å®¢è§‚é¢˜è€ƒè¯•å·²ç»“æŸ' 
                    : 'ä¸»è§‚é¢˜è€ƒè¯•å·²ç»“æŸ';
                document.getElementById('countdownTitle').textContent = currentState.isObjective 
                    ? 'å®¢è§‚é¢˜è€ƒè¯•å·²ç»“æŸ' 
                    : 'ä¸»è§‚é¢˜è€ƒè¯•å·²ç»“æŸ';
                return;
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / (1000));

            // æ ¹æ®çŠ¶æ€æ˜¾ç¤ºå¤©æ•°æˆ–å‘¨æ•°
            if (currentState.showWeek) {
                const weeks = Math.ceil(days / 7); // å‘ä¸Šå–æ•´
                document.getElementById('dayNum').textContent = weeks;
                document.getElementById('dayLabel').textContent = 'å‘¨';
            } else {
                document.getElementById('dayNum').textContent = days;
                document.getElementById('dayLabel').textContent = 'å¤©';
            }

            flipNumber('hourVal', hours);
            flipNumber('minuteVal', minutes);
            flipNumber('secondVal', seconds);
        }

        // åˆ‡æ¢å¤©æ•°/å‘¨æ•°æ˜¾ç¤º
        function toggleDayWeek() {
            currentState.showWeek = !currentState.showWeek;
            saveSettings();
            updateCountdown();
            showToast(`å·²åˆ‡æ¢ä¸º${currentState.showWeek ? 'å‘¨æ•°' : 'å¤©æ•°'}æ˜¾ç¤º`);
            showRandomTimeMotivation();
        }

        // æ—¶åˆ†ç§’ç‚¹å‡»åŠ¨æ•ˆ
        function clockClickEffect(element) {
            element.classList.add('clicked');
            setTimeout(() => {
                element.classList.remove('clicked');
            }, 500);
            showRandomTimeMotivation();
        }

        function flipNumber(id, value) {
            const el = document.getElementById(id);
            const box = el.parentElement;
            const newVal = String(value).padStart(2, '0');
            
            if (el.textContent !== newVal) {
                box.classList.add('flipping');
                setTimeout(() => {
                    el.textContent = newVal;
                    box.classList.remove('flipping');
                }, 300);
            }
        }

        function checkExamPhase() {
            const now = new Date().getTime();
            // ä»…åœ¨ç”¨æˆ·æœªæ‰‹åŠ¨åˆ‡æ¢æ—¶ï¼Œè‡ªåŠ¨æ›´æ–°è€ƒè¯•é˜¶æ®µ
            const savedData = localStorage.getItem('fakao2026_settings');
            const hasManualSwitch = savedData && JSON.parse(savedData).isObjective !== undefined;
            
            if (!hasManualSwitch) {
                if (now > EXAM_DATE_OBJ && now < EXAM_DATE_SUB) {
                    currentState.isObjective = false;
                    updateExamTypeUI();
                } else if (now > EXAM_DATE_SUB) {
                    document.getElementById('examPhase').textContent = '2026æ³•è€ƒå·²ç»“æŸ';
                    document.getElementById('countdownTitle').textContent = 'æœŸå¾…2027';
                }
            }
        }

        /* ========== é‡Œç¨‹ç¢‘è®¡ç®—ï¼ˆé€‚é…åˆ‡æ¢ï¼‰ ========== */
        function updateMilestone() {
            const now = new Date().getTime();
            const target = currentState.isObjective ? EXAM_DATE_OBJ : EXAM_DATE_SUB;
            const total = target - START_DATE;
            const passed = now - START_DATE;
            let percent = (passed / total) * 100;
            percent = Math.max(0, Math.min(100, percent));
            
            document.getElementById('milestoneFill').style.width = percent + '%';
            
            const nodes = document.querySelectorAll('.milestone-node');
            nodes.forEach((node, idx) => {
                const threshold = idx * 33.3;
                if (percent >= threshold) {
                    node.classList.add('active');
                } else {
                    node.classList.remove('active');
                }
            });
        }

        /* ========== åè¨€ç³»ç»Ÿ ========== */
        function renderPoem() {
            const p = POEMS[currentState.poemIndex];
            document.getElementById('poemText').textContent = p.text;
            document.getElementById('poemText').style.opacity = 0;
            setTimeout(() => {
                document.getElementById('poemText').style.transition = 'opacity 0.5s';
                document.getElementById('poemText').style.opacity = 1;
            }, 50);
        }

        function nextPoem() {
            currentState.poemIndex = (currentState.poemIndex + 1) % POEMS.length;
            renderPoem();
            saveSettings();
        }

        function prevPoem() {
            currentState.poemIndex = (currentState.poemIndex - 1 + POEMS.length) % POEMS.length;
            renderPoem();
            saveSettings();
        }

        document.getElementById('poemContainer').addEventListener('click', nextPoem);

        /* ========== ä¸»é¢˜ä¸èƒŒæ™¯ ========== */
        function switchTheme() {
            currentState.theme = (currentState.theme + 1) % THEMES.length;
            currentState.bgMode = (currentState.bgMode + 1) % BG_MODES.length;
            applyTheme(currentState.theme);
            initBackground();
            saveSettings();
            showToast(`å·²åˆ‡æ¢è‡³${currentState.theme === 0 ? 'æ·±å¤œ' : currentState.theme === 1 ? 'æ—¥å‡º' : 'æŠ¤çœ¼'}æ¨¡å¼`);
        }

        function applyTheme(index) {
            document.body.setAttribute('data-theme', THEMES[index]);
            const colors = ['#0f172a', '#ffecd2', '#e8f5e9'];
            document.body.style.backgroundColor = colors[index];
        }

        function saveSettings() {
            localStorage.setItem('fakao2026_settings', JSON.stringify({
                theme: currentState.theme,
                bgMode: currentState.bgMode,
                poemIndex: currentState.poemIndex,
                pomoOriginalTime: currentState.pomoOriginalTime,
                showWeek: currentState.showWeek,
                isObjective: currentState.isObjective // ä¿å­˜è€ƒè¯•ç±»å‹çŠ¶æ€
            }));
        }

        /* ========== Canvas åŠ¨æ€èƒŒæ™¯ç³»ç»Ÿ ========== */
        let canvas, ctx, animationId;
        let particles = [];

        function initBackground() {
            canvas = document.getElementById('bgCanvas');
            ctx = canvas.getContext('2d');
            resizeCanvas();
            
            if (animationId) cancelAnimationFrame(animationId);
            
            particles = [];
            const mode = BG_MODES[currentState.bgMode];
            
            if (mode === 'stars') initStars();
            else if (mode === 'rain') initRain();
            else if (mode === 'ink') initInk();
            
            animate();
        }

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        window.addEventListener('resize', resizeCanvas);

        function initStars() {
            for (let i = 0; i < 100; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 2,
                    speedY: -Math.random() * 0.5 - 0.1,
                    opacity: Math.random()
                });
            }
        }

        function initRain() {
            for (let i = 0; i < 200; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    length: Math.random() * 20 + 10,
                    speedY: Math.random() * 15 + 10,
                    opacity: Math.random() * 0.5 + 0.1
                });
            }
        }

        function initInk() {
            for (let i = 0; i < 30; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 100 + 50,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    opacity: Math.random() * 0.1
                });
            }
        }

        function animate() {
            const mode = BG_MODES[currentState.bgMode];
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (mode === 'ink') {
                ctx.fillStyle = currentState.theme === 2 ? 'rgba(232, 245, 233, 0.1)' : 'rgba(15, 23, 42, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }

            particles.forEach(p => {
                if (mode === 'stars') {
                    p.y += p.speedY;
                    if (p.y < 0) p.y = canvas.height;
                    ctx.fillStyle = `rgba(255, 255, 255, ${p.opacity})`;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fill();
                } else if (mode === 'rain') {
                    p.y += p.speedY;
                    if (p.y > canvas.height) {
                        p.y = -20;
                        p.x = Math.random() * canvas.width;
                    }
                    ctx.strokeStyle = `rgba(174, 194, 224, ${p.opacity})`;
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(p.x, p.y);
                    ctx.lineTo(p.x, p.y + p.length);
                    ctx.stroke();
                } else if (mode === 'ink') {
                    p.x += p.vx;
                    p.y += p.vy;
                    if (p.x < -100 || p.x > canvas.width + 100) p.vx *= -1;
                    if (p.y < -100 || p.y > canvas.height + 100) p.vy *= -1;
                    
                    const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.size);
                    const color = currentState.theme === 2 ? '100, 150, 130' : '100, 100, 120';
                    grad.addColorStop(0, `rgba(${color}, ${p.opacity})`);
                    grad.addColorStop(1, `rgba(${color}, 0)`);
                    ctx.fillStyle = grad;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
            
            animationId = requestAnimationFrame(animate);
        }

        /* ========== æ‰‹åŠ¿æ”¯æŒ ========== */
        function initGestures() {
            let startX = 0;
            let startY = 0;
            let startDistance = 0;
            
            const card = document.getElementById('mainCard');
            
            card.addEventListener('touchstart', (e) => {
                if (e.touches.length === 1) {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                } else if (e.touches.length === 2) {
                    startDistance = Math.hypot(
                        e.touches[0].clientX - e.touches[1].clientX,
                        e.touches[0].clientY - e.touches[1].clientY
                    );
                }
            }, {passive: true});
            
            card.addEventListener('touchend', (e) => {
                if (e.changedTouches.length === 1) {
                    const endX = e.changedTouches[0].clientX;
                    const diff = endX - startX;
                    
                    if (Math.abs(diff) > 50) {
                        if (diff > 0) prevPoem();
                        else nextPoem();
                    }
                }
            }, {passive: true});
            
            card.addEventListener('touchmove', (e) => {
                if (e.touches.length === 2 && startDistance > 0) {
                    e.preventDefault();
                    const currentDistance = Math.hypot(
                        e.touches[0].clientX - e.touches[1].clientX,
                        e.touches[0].clientY - e.touches[1].clientY
                    );
                    
                    if (Math.abs(currentDistance - startDistance) > 50) {
                        switchTheme();
                        startDistance = 0;
                    }
                }
            }, {passive: false});
        }

        /* ========== æ³•è€ƒåŠ æ²¹æŒ‰é’® ========== */
        function toggleCheer() {
            const btn = document.getElementById('cheerBtn');
            const icon = document.getElementById('musicIcon');
            
            // åˆ‡æ¢éŸ³ä¹æ’­æ”¾çŠ¶æ€
            if (!currentState.isPlaying) {
                cheerAudio.play().then(() => {
                    currentState.isPlaying = true;
                    btn.classList.add('playing');
                    icon.textContent = 'ğŸ¶';
                    showToast('å¤‡è€ƒéŸ³ä¹å·²å¼€å¯');
                }).catch(err => {
                    console.error('éŸ³ä¹æ’­æ”¾å¤±è´¥:', err);
                    showToast('éŸ³ä¹æ’­æ”¾å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                });
            } else {
                cheerAudio.pause();
                currentState.isPlaying = false;
                btn.classList.remove('playing');
                icon.textContent = 'ğŸµ';
                showToast('å¤‡è€ƒéŸ³ä¹å·²æš‚åœ');
            }
            
            // æ˜¾ç¤ºéšæœºé¼“åŠ±è¯­
            showEncouragement();
        }

        function showEncouragement() {
            const msg = ENCOURAGES[Math.floor(Math.random() * ENCOURAGES.length)];
            const el = document.getElementById('encourageMsg');
            el.textContent = msg;
            el.classList.remove('opacity-0');
            
            setTimeout(() => {
                el.classList.add('opacity-0');
            }, 3000);
        }

        /* ========== ç•ªèŒ„é’ŸåŠŸèƒ½ ========== */
        function togglePomodoro() {
            const layer = document.getElementById('pomodoroLayer');
            if (layer.classList.contains('hidden-section')) {
                layer.classList.remove('hidden-section');
                resetPomodoro();
            } else {
                layer.classList.add('hidden-section');
                if (currentState.pomoRunning) {
                    clearInterval(currentState.pomoInterval);
                    currentState.pomoRunning = false;
                }
            }
        }

        // é‡ç½®ç•ªèŒ„é’Ÿ
        function resetPomodoro() {
            currentState.pomoTime = currentState.pomoOriginalTime;
            updatePomoDisplay();
            document.getElementById('pomoStartBtn').textContent = 'å¼€å§‹';
        }

        // æ›´æ–°ç•ªèŒ„é’Ÿæç¤ºæ–‡å­—
        function updatePomoTipText() {
            const minutes = Math.floor(currentState.pomoOriginalTime / 60);
            const tipText = document.getElementById('pomoTipText');
            tipText.innerHTML = `ä¿æŒä¸“æ³¨ï¼Œ${minutes}åˆ†é’ŸåçŸ­æš‚ä¼‘æ¯<br>æ³•å¾‹äººçš„è‡ªå¾‹ä»æ¯ä¸€åˆ»å¼€å§‹`;
        }

        // è®¾ç½®ç•ªèŒ„é’Ÿè‡ªå®šä¹‰æ—¶é—´
        function setCustomPomodoroTime() {
            const input = document.getElementById('pomoCustomTime');
            const minutes = parseInt(input.value.trim());
            
            // è¾“å…¥åˆæ³•æ€§æ ¡éªŒ
            if (isNaN(minutes) || minutes < 1 || minutes > 60) {
                showToast('è¯·è¾“å…¥1-60ä¹‹é—´çš„æœ‰æ•ˆæ•°å­—');
                return;
            }
            
            // åœæ­¢å½“å‰è¿è¡Œçš„ç•ªèŒ„é’Ÿ
            if (currentState.pomoRunning) {
                clearInterval(currentState.pomoInterval);
                currentState.pomoRunning = false;
            }
            
            // æ›´æ–°ç•ªèŒ„é’Ÿæ—¶é—´å¹¶ä¿å­˜
            currentState.pomoOriginalTime = minutes * 60;
            currentState.pomoTime = minutes * 60;
            updatePomoDisplay();
            updatePomoTipText();
            document.getElementById('pomoStartBtn').textContent = 'å¼€å§‹';
            saveSettings();
            showToast(`ç•ªèŒ„é’Ÿæ—¶é—´å·²è®¾ä¸º${minutes}åˆ†é’Ÿ`);
            input.value = '';
        }

        function updatePomoDisplay() {
            const mins = Math.floor(currentState.pomoTime / 60);
            const secs = currentState.pomoTime % 60;
            document.getElementById('pomoTime').textContent = 
                `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            
            const total = currentState.pomoOriginalTime;
            const progress = (total - currentState.pomoTime) / total;
            const offset = 289 - (289 * progress);
            document.getElementById('pomoProgress').style.strokeDashoffset = offset;
        }

        function startPomodoro() {
            if (currentState.pomoRunning) {
                clearInterval(currentState.pomoInterval);
                currentState.pomoRunning = false;
                document.getElementById('pomoStartBtn').textContent = 'ç»§ç»­';
                return;
            }
            
            currentState.pomoRunning = true;
            document.getElementById('pomoStartBtn').textContent = 'æš‚åœ';
            
            currentState.pomoInterval = setInterval(() => {
                if (currentState.pomoTime > 0) {
                    currentState.pomoTime--;
                    updatePomoDisplay();
                } else {
                    clearInterval(currentState.pomoInterval);
                    currentState.pomoRunning = false;
                    document.getElementById('pomoStartBtn').textContent = 'å®Œæˆ';
                    showToast('ä¸“æ³¨æ—¶é—´ç»“æŸï¼ä¼‘æ¯ä¸€ä¸‹å§');
                    
                    // æ’­æ”¾ç»“æŸæç¤ºéŸ³
                    try {
                        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        osc.frequency.value = 523.25;
                        gain.gain.value = 0.1;
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        osc.start();
                        osc.stop(audioContext.currentTime + 0.5);
                    } catch (e) {
                        console.log('æç¤ºéŸ³æ’­æ”¾å¤±è´¥:', e);
                    }
                }
            }, 1000);
        }

        /* ========== æ—¶é—´æ¿€åŠ±è¯­åŠŸèƒ½ ========== */
        function showRandomTimeMotivation() {
            const motivationEl = document.getElementById('timeMotivation');
            const randomMsg = TIME_MOTIVATIONS[Math.floor(Math.random() * TIME_MOTIVATIONS.length)];
            motivationEl.textContent = randomMsg;
            motivationEl.classList.add('show');
            
            setTimeout(() => {
                motivationEl.classList.remove('show');
            }, 5000);
        }

        /* ========== å·¥å…·å‡½æ•° ========== */
        function showToast(text) {
            const toast = document.getElementById('toast');
            toast.textContent = text;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // é˜²æ­¢ç§»åŠ¨ç«¯åŒå‡»ç¼©æ”¾
        let lastTouchEnd = 0;
        document.addEventListener('touchend', (e) => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // é¡µé¢å¸è½½æ—¶æš‚åœéŸ³ä¹
        window.addEventListener('beforeunload', () => {
            if (cheerAudio) {
                cheerAudio.pause();
            }
        });

    </script>
</body>
</html>